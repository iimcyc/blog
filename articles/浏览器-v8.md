# 浏览器 —— V8 执行 JavaScript 代码

关键词：编译器（Compiler）、解释器（Interpreter）、抽象语法树（AST）、字节码（Bytecode）、即时编译器（JIT）

## 编译器和解释器

编译型语言： C/C++ 、 GO

解释型语言： Python 、 JavaScript

![编译器和解释器“翻译”代码](http://storage.icyc.cc/p/20211121/rc-upload-1637502079456-4.png)

## V8 执行 JavaScript 代码

![V8 执行一段代码流程图](http://storage.icyc.cc/p/20211121/rc-upload-1637501367811-4.png)

### 1. 生成抽象语法树（AST）和执行上下文

第一阶段是分词（tokenize），又称词法分析，起作用是将一行行的源码拆成一个个 token 。

第二阶段是解析（parse），又称语法分析，其作用是将上一步生成的 token 数据，根据语法规则转为 AST 。

接下来 V8 就会生成该段代码的执行上下文。

### 2. 生成字节码

解释器 Ignition 根据 AST 生成字节码。

### 3. 执行代码

通常第一次执行的字节码，解释器 Ignition 会逐条解析执行。

如果有**热点代码**，编译器 TurboFan 会把该段字节码编译为机器码，再次执行这段代码时，只需要执行机器码，大大提升了执行效率。

字节码配合解释器和编译器的技术叫做**即时编译（JIT）**。 Java 和 Python 的虚拟机也都是基于这种技术实现的。具体到 V8 ，是指解释器 Ignition 在解释执行字节码的同时，收集代码信息，当发现某一部分代码经常使用，编译器 TurboFan 会把热点字节码转换为机器码，并把转换后的机器码保存起来，以备下次使用。

**参考**

* 《浏览器工作原理与实践》
